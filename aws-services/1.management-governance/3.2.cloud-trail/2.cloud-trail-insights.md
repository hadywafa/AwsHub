# ğŸ“Š **What is AWS CloudTrail Insights?**

> ğŸ“– **CloudTrail Insights** is an _optional_ feature of AWS CloudTrail that helps you **automatically detect unusual or anomalous API activity** in your AWS account.  
> âœ… It uses **machine learning** to establish a baseline of "normal" behavior and then detects **anomalies** â€” such as sudden spikes in API calls or unexpected usage patterns.

---

<div style="text-align: center;">
    <img src="images/cloud-trail-insights.png" alt="CloudTrail Insights" style="border-radius: 10px; width: 100%;">
</div>

---

## ğŸ§  **Why Use It?**

Regular CloudTrail logs **everything**, but they donâ€™t tell you **whatâ€™s unusual**.

**CloudTrail Insights**:

- ğŸ” Highlights **abnormal spikes or drops** in activity.
- ğŸ“ˆ Tracks **write-type management events** (e.g., launching EC2, creating users).
- ğŸ“¬ Sends **notifications or triggers automation** when anomalies are detected.

---

## ğŸ”§ **How It Works (Under the Hood)**

### Step-by-step

1. âœ… **Enabled on a Trail** (Insights are _not enabled by default_).
2. ğŸ“Š **Establishes a Baseline**: Learns "normal" behavior by monitoring patterns in API calls.
3. ğŸš¨ **Detects Anomalies**: Flags when activity deviates significantly (e.g., 20x usual rate).
4. ğŸ’¾ **Stores Insight Events** in your CloudTrail trail (S3 bucket).
5. ğŸ”” **Optional**: Sends real-time notifications via **EventBridge**.

---

## ğŸ” **Examples of Detected Anomalies**

| Behavior                          | Example                                          |
| --------------------------------- | ------------------------------------------------ |
| ğŸ’¥ Sudden API spikes              | `RunInstances` called 100x more than usual       |
| ğŸ§‘â€ğŸ’» IAM misuse                  | Burst of `AttachRolePolicy` calls                |
| âŒ› Missing expected behavior      | No scheduled `StartInstances` calls              |
| ğŸ› ï¸ Abnormal provisioning patterns | Launching 200 EC2s in a region you've never used |

---

## ğŸ§ª **Insight Event Format (Simplified)**

```json
{
  "eventName": "StartInstances",
  "insightDetails": {
    "state": "Start",
    "eventSource": "ec2.amazonaws.com",
    "insightType": "ApiCallRateInsight",
    "statistics": {
      "baseline": 1,
      "insight": 50
    }
  }
}
```

â¡ï¸ This means: The `StartInstances` API was called **50 times**, while baseline is just **1**.

---

## âš™ï¸ **How to Enable CloudTrail Insights**

In the AWS Console:

1. Go to **CloudTrail > Trails**
2. Click on your trail
3. Under **Management events**, check â€œEnable Insights eventsâ€
4. Choose **write-only** events (read-only are not supported)

---

## ğŸ“¦ **Where Do Insights Go?**

- Stored in **S3** (if trail is configured to store there)
- Can be sent to **CloudWatch Logs** or **EventBridge**
- You can set up **alerts or remediation workflows**

---

## ğŸ’° **Cost Consideration**

CloudTrail Insights is **not free**.

| Tier                              | Approximate Cost   |
| --------------------------------- | ------------------ |
| Per 100,000 write events analyzed | \~\$0.35 USD/month |

ğŸ§  Only **write-type** **management events** are analyzed (not data events or read-only actions).

---

## âœ… **When to Use CloudTrail Insights**

| Use Case                 | Reason                                                |
| ------------------------ | ----------------------------------------------------- |
| ğŸ” Security auditing     | Detect IAM or VPC misuse automatically                |
| ğŸš¨ Alerting              | Get alerts for suspicious API surges                  |
| ğŸ“Š Anomaly Detection     | Monitor spikes in provisioning or destructive actions |
| ğŸ› ï¸ Operational awareness | Know when something â€œunusualâ€ starts happening        |

---

## ğŸ“Œ Summary

| Feature               | CloudTrail Insights                        |
| --------------------- | ------------------------------------------ |
| Detects anomalies     | âœ… Yes â€“ based on API rate/volume          |
| Works on event type   | âœ… Management Events (write-only)          |
| How to receive alerts | EventBridge, CloudWatch, or S3             |
| Uses ML               | âœ… Builds baselines automatically          |
| Billing               | ğŸ’° Paid add-on, per API event analyzed     |
| Example use case      | Detect spike in `TerminateInstances` calls |
