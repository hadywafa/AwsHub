# ğŸ›¡ï¸ **AWS CloudTrail â€“ Full Visibility, Full Control**

> Think of **CloudTrail** as your AWS **security camera** and **audit logbook** â€“ quietly tracking **everything that happens** in your account so you donâ€™t miss a beat.

---

## ğŸ” **What Is AWS CloudTrail?**

**AWS CloudTrail** provides **governance, compliance, auditing, and operational monitoring** for your AWS account by **recording all API activity** â€“ whether triggered by the **Console**, **CLI**, **SDK**, or AWS **services**.

### âœ… Highlights

- ğŸ§  **Enabled by default**
- ğŸ“ Logs **all API calls** and **event history**
- ğŸ“¦ Stores events **90 days by default** (longer with S3)
- ğŸ” Supports **multi-region** and **single-region** trails
- ğŸ”„ Integrates with **CloudWatch Logs**, **S3**, **Athena**, and **EventBridge**
- ğŸ” Critical for **security investigation**, **change tracking**, and **alerting**

---

## ğŸ§° **How CloudTrail Works (Internal Flow)**

<div align="center">
  <img src="images/cloud-trail-lifecycle.png" alt="cloudtrail-lifecycle" style="border-radius: 10px; width: 80%;" />
</div>

| Step | What Happens                                       |
| ---- | -------------------------------------------------- |
| 1ï¸âƒ£   | User or service performs an API call               |
| 2ï¸âƒ£   | CloudTrail **records the call**                    |
| 3ï¸âƒ£   | Logs stored in **Event History (90d)**             |
| 4ï¸âƒ£   | If trail exists â†’ logs go to **S3**                |
| 5ï¸âƒ£   | Optionally stream to **CW Logs, EventBridge, SNS** |

---

## ğŸ“œ **Types of CloudTrail Events**

### ğŸ”§ **1. Management Events (Control Plane)**

- ğŸ’¡ Track operations **on AWS resources** like creation, deletion, IAM changes.
- âœ… **Enabled by default** (Free)
- âœğŸ» Supports **Read vs. Write split**

> Example: `CreateBucket`, `AttachRolePolicy`, `CreateSubnet`

---

### ğŸ“¦ **2. Data Events (Data Plane)**

- ğŸ’¡ Track **resource-level activity** (e.g., S3 object actions, Lambda invokes)
- âŒ **Disabled by default** â€“ must be enabled manually
- ğŸ’° Charged due to high event volume

> Example: `GetObject`, `PutObject`, `InvokeFunction`

---

### ğŸ“Š **CloudTrail Insights Events**

> Detect **unusual patterns** in management API usage automatically

| ğŸ” Use Cases                                   |
| ---------------------------------------------- |
| Unexpected resource provisioning               |
| IAM access spikes or surges                    |
| Gaps in expected maintenance activity          |
| Rapid service API bursts (e.g., failed logins) |

- âœ… Enables a baseline of normal
- ğŸ“¬ **Anomalies appear in Console**
- ğŸª£ Sent to **S3**
- ğŸ”” Triggers **EventBridge event**

---

## ğŸ—ƒï¸ **Where Can CloudTrail Send Logs?**

| Destination            | Description                                  |
| ---------------------- | -------------------------------------------- |
| ğŸ“ **S3**              | Archive logs indefinitely                    |
| ğŸ“Š **CloudWatch Logs** | Real-time monitoring, metric filters, alarms |
| ğŸ§  **EventBridge**     | Automate workflows based on matching events  |

> âœ… Logs are **encrypted** by default using SSE-S3  
> ğŸ” Can use **SSE-KMS** for custom keys

---

## ğŸ“… **Event Retention & Analysis**

<div style="text-align: center;">
    <img src="images/cloud-trail-event-retention.png" alt="cloud-trail-event-retention" style="border-radius: 10px; width: 80%;" />
</div>

---

| Location                     | Retention                     |
| ---------------------------- | ----------------------------- |
| **CloudTrail Event History** | 90 days in console (default)  |
| **S3 Trail**                 | Infinite (as per your bucket) |
| **Athena Querying**          | Use SQL on archived JSON logs |

> Example:

```sql
SELECT eventTime, eventName, userIdentity.userName
FROM cloudtrail_logs
WHERE eventSource = 'iam.amazonaws.com'
  AND eventName = 'AttachUserPolicy';
```

---

## ğŸ” **CloudTrail Log File Integrity Validation**

> CloudTrail offers **log file integrity validation** to ensure that your log files havenâ€™t been tampered with.

---

<div align="center">
  <img src="images/cloud-trail-log-file-integrity-validation.png" alt="Integrity Validation" style="border-radius: 10px; width: 80%;" />
</div>

---

- Every log file stored in S3 can be **cryptographically signed and hashed**
- You can use the CloudTrail CLI or SDK to **validate** log files were not tampered with
- Crucial for **forensic investigations** or **security compliance audits**

---

## âœ… **Best Practices**

- âœ… Use **multi-region trails**
- âœ… Enable **data events** for critical buckets/functions
- âœ… Integrate with **CloudWatch Logs** or **EventBridge** for real-time reactions
- âœ… Archive to **S3 with lifecycle policy**
- âœ… Enable **Insights** in high-sensitivity environments
- âœ… Enable **log file integrity validation**

---

## ğŸ§  Summary

| Feature                   | Value                                       |
| ------------------------- | ------------------------------------------- |
| ğŸ” Records API calls      | âœ… CLI, SDK, Console, AWS Service activity  |
| ğŸ“¦ Retention Options      | âœ… 90 days (Event History) / unlimited (S3) |
| ğŸ“œ Event Types            | âœ… Management, Data, Insights               |
| âš™ï¸ Automation Compatible  | âœ… Triggers EventBridge, Lambda, SNS        |
| ğŸ” Security-Grade Logging | âœ… KMS encryption, integrity validation     |
| ğŸ“Š Integrated Monitoring  | âœ… CloudWatch Logs, Athena, SIEM pipelines  |
