# ğŸ•µï¸â€â™‚ï¸ **Amazon CloudWatch Synthetics Canary**

> Configurable script that monitor your APIs, URLs, Websites, â€¦etc

---

<div style="text-align: center;">
    <img src="images/cw-synthetics-canary.png" alt="cw-synthetics-canary" style="border-radius: 10px; width: 90%;">
</div>

---

## ğŸš€ What Is a Synthetics Canary?

A **Canary** is a **scripted, automated browser test** that **simulates user interactions** with your application or API.

âœ… It runs on a schedule, **just like a real user**, and helps detect:

- Broken links
- API failures
- Page load delays
- Visual issues

> Named after the **â€œcanary in a coal mineâ€** ğŸ¤ â€” it warns you _before_ users are impacted.

---

## ğŸ§© Real-World Example

> You build an ecommerce app. Create 3 canaries:

1. `HomepageCanary` â€“ loads homepage every 1 min
2. `LoginCanary` â€“ logs in with test credentials every 5 min
3. `CheckoutAPI` â€“ checks response from `/api/checkout`

ğŸ¯ If login breaks or checkout fails, youâ€™ll know **before your customers** do.

---

## âš™ï¸ Integration with CloudWatch

âœ… Each canary automatically creates:

| Resource               | Use                                            |
| ---------------------- | ---------------------------------------------- |
| **CloudWatch Metrics** | For success %, duration, failures              |
| **CloudWatch Logs**    | Stores logs, results, failures, screenshots    |
| **Alarms**             | Optional alarms on failure rate, latency, etc. |
| **S3 Bucket**          | Stores screenshots and HAR files               |

---

## ğŸ› ï¸ Scripting Canaries

- Written in **Node.js** or **Python**
- Use the [Synthetics API](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Synthetics_Canaries_Library.html)
- Script is run by AWS Lambda in the background
- Headless Chrome browser is included

### ğŸ§  Example

```javascript
const synthetics = require("Synthetics");
const log = require("SyntheticsLogger");

exports.handler = async function () {
  const page = await synthetics.getPage();
  await page.goto("https://example.com");
  log.info("Loaded the homepage");
  await page.screenshot({ path: "/tmp/example.png" });
};
```

---

## ğŸ“¦ Canary Types (Blueprints)

| Blueprint                | What It Does                                             |
| ------------------------ | -------------------------------------------------------- |
| **Heartbeat Monitor**    | Load a URL, take a screenshot, record HTTP archive (HAR) |
| **API Canary**           | Call REST APIs (GET, POST), validate responses           |
| **Broken Link Checker**  | Finds broken links on a webpage                          |
| **GUI Workflow Builder** | Automate flows like logging in, submitting forms         |
| **Visual Monitoring**    | Compare UI screenshots across runs                       |
| **Recorder**             | Auto-generate canary scripts by recording your clicks    |

---

## ğŸ§  Key Features

| Feature                           | Description                                         |
| --------------------------------- | --------------------------------------------------- |
| âœ… **Runs Headless Browser**      | Uses headless Chrome to simulate real interactions  |
| ğŸ• **Scheduled Monitoring**       | Runs every X minutes (e.g., every 1, 5, or 15 mins) |
| ğŸ” **Test Multiple Flows**        | API calls, login forms, checkout flows, etc.        |
| ğŸ–¼ï¸ **Visual Screenshots**         | Captures screenshots & performance data             |
| ğŸ“¦ **Stores HAR Files**           | Keeps HTTP Archive files for debugging              |
| ğŸ“Š **Integrated with CloudWatch** | Sends metrics and logs, triggers alarms             |
| ğŸ” **Supports IAM & KMS**         | Secure, auditable, and encrypted                    |

---

## ğŸ§ª Common Canary Use Cases

| Use Case                         | Example                                           |
| -------------------------------- | ------------------------------------------------- |
| ğŸŒ **Website Uptime**            | Ping homepage every minute                        |
| ğŸ” **Login Flows**               | Simulate user login with form input               |
| ğŸ” **API Monitoring**            | Check `/health` or `/orders` endpoint             |
| ğŸ”— **Broken Link Detection**     | Crawl pages and find 404s                         |
| ğŸ§ª **Visual Regression Testing** | Compare current UI screenshot to a baseline image |

---

## ğŸ” Security & Permissions

- Canaries use **IAM Roles** to access resources securely
- Logs & artifacts are **encrypted using AWS KMS**
- You can configure **VPC access** for private endpoint testing

---

## ğŸ’° Pricing

| Cost Component     | Notes                            |
| ------------------ | -------------------------------- |
| Canary run         | Per run, based on duration       |
| Logs & screenshots | Stored in S3 and CloudWatch Logs |
| X-Ray trace data   | Extra if enabled                 |

ğŸ§  You pay per **run** and **storage** used.

---

## âœ… Summary â€“ Why Use Synthetics Canary?

| Benefit                      | Outcome                                             |
| ---------------------------- | --------------------------------------------------- |
| ğŸ¯ Proactive Monitoring      | Catch issues _before_ users do                      |
| ğŸ‘¨â€ğŸ’» Simulates Real Users      | Not just uptime, but **user experience**            |
| ğŸ§ª Easy to Script or Use GUI | Flexible for devs, testers, or SREs                 |
| ğŸ“Š Full observability        | Logs, metrics, screenshots, alarms â€” all integrated |
| ğŸ”„ Runs on schedule          | Every minute if you want â€” auto-notify on failure   |

## ğŸ‰ Very Important Examples

[Use CloudWatch Synthetics to Monitor Your Web Application](https://awsfundamentals.com/blog/use-cloudwatch-synthetics-to-monitor-your-web-application)

[Managing CloudWatch Synthetics canaries at scale](https://aws.amazon.com/blogs/mt/managing-cloudwatch-synthetics-canaries-at-scale/)
