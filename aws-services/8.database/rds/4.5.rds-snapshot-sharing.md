# ğŸ”„ Amazon RDS Snapshots Sharing

> _Seamlessly share your database state across accounts â€“ securely and flexibly._

---

<div align="center">
  <img src="images/rds-snapshot-share.png" alt="RDS Snapshot Sharing Overview" style="border-radius: 10px;" width="60%" >
</div>

---

## ğŸ“š What Is RDS Snapshot Sharing?

Amazon RDS allows you to take **manual snapshots** of your DB instances and **share them** with other AWS accounts. This is useful for:

- Cross-account collaboration
- DR/backup copy in another account
- Restoring databases for QA/test environments

---

## ğŸ” Sharing Snapshot Types

| Snapshot Type         | Can Be Shared? | Notes                                  |
| --------------------- | -------------- | -------------------------------------- |
| âœ… Manual Snapshot    | âœ… Yes         | Share directly                         |
| âŒ Automated Snapshot | âŒ No          | Must **copy to manual snapshot** first |
| ğŸ” Encrypted Snapshot | âœ… With KMS    | Share **KMS key + snapshot** together  |

---

## ğŸ“¦ Sharing an Unencrypted Snapshot

1. Take a **manual snapshot** of your DB instance
2. Share the snapshot with a target AWS account
3. That account can **restore** the snapshot to create a new DB instance

ğŸ’¡ **IAM permissions required** to access and restore the shared snapshot.

---

## ğŸ” Sharing an Encrypted Snapshot (with KMS)

If your snapshot is encrypted with a **customer-managed KMS key**, you must:

- âœ… Share the **snapshot**
- âœ… Share the **KMS key** with the target account
- âœ… Grant **required IAM permissions** on the key

---

<div align="center">
  <img src="images/rds-sharing-encrypted-snapshot.png" alt="RDS Snapshot Sharing Overview" style="border-radius: 10px;" width="60%">
</div>

---

### ğŸ”‘ Required KMS Permissions

```json
{
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::<account-b-id>:root"
      },
      "Action": [
        "kms:DescribeKey",
        "kms:CreateGrant",
        "kms:Encrypt",
        "kms:Decrypt",
        "kms:GenerateDataKey",
        "kms:ReEncrypt*"
      ],
      "Resource": "*"
    }
  ]
}
```

---

### ğŸ§ª Example: Cross-Account Snapshot Sharing

#### ğŸ¯ Goal

Share a **CMK-encrypted snapshot** (`mydbsnapshot`) from Account A to Account B.

#### âœ… Steps

1. ğŸ“¦ **Account A**: Create manual snapshot of RDS DB
2. ğŸ” **Account A**: Share snapshot + CMK key permissions with Account B
3. ğŸ“¥ **Account B**: Access snapshot and restore it to a new RDS DB

---

<div align="center">
  <img src="images/rds-snapshot-cross-account.png" alt="Encrypted RDS Snapshot Sharing" style="border-radius: 10px;">
</div>

---

## ğŸ“Œ Important Notes

- Encrypted snapshots must use **customer-managed CMKs**
- Cross-region copy creates a **new snapshot + CMK encryption** in the target region
- Use **resource sharing** carefully â€“ your data is portable, but access must be tightly controlled

---

## ğŸ›¡ï¸ Best Practices

- âœ… Always enable **encryption** on snapshots (KMS)
- âœ… Use **IAM condition keys** to control access by tag or resource
- ğŸ”’ Never share production snapshots without redacting sensitive data
- ğŸ“– Enable **CloudTrail** to monitor access and sharing activities

---

## ğŸ”„ Restore Shared Snapshot in Account B

```bash
aws rds restore-db-instance-from-db-snapshot \
    --db-instance-identifier restore-db \
    --db-snapshot-identifier arn:aws:rds:us-east-1:<account-a-id>:snapshot:mydbsnapshot
```

---

## âœ… Summary

| âœ… Feature              | âœ… Support     |
| ----------------------- | -------------- |
| Manual Snapshot Sharing | âœ… Yes         |
| Automated Snapshot      | âŒ Copy First  |
| Encrypted Snapshot      | âœ… + KMS Share |
| Cross-Region Copy       | âœ… Supported   |
