# â˜ï¸ **How AWS EventBridge Works Internally**

> _For Devs & Architects Who Hate Black Boxes and Love Knowing "What Really Happens"_

---

## ğŸ§  What Is AWS EventBridge _Really_?

> Think of EventBridge as a **cloud-native event router** â€“ it listens to changes, matches them to rules, and sends them to where they matter.

---

> âœ… **Successor of CloudWatch Events**, with added power:

- **No infrastructure to manage**
- **Built-in filtering, transformation, retries, and DLQs**
- **Integrates with AWS Services, SaaS apps, and custom apps**

**You donâ€™t poll it. You donâ€™t provision it.** It **just listens and routes** â€” in milliseconds.

---

## âš™ï¸ Internals: How EventBridge Reacts to an S3 Upload

Letâ€™s explore **how AWS services interact behind the scenes** when a file is uploaded to S3 and you want to trigger something like **CodePipeline**.

---

### ğŸ§± Step-by-Step: EventBridge in Action

#### 1ï¸âƒ£ Uploading to S3 (`PutObject`)

- User or app uploads a file.
- S3 **does not natively emit to EventBridge** (âŒ no direct integration).
- Instead, **CloudTrail** records the `PutObject` API call.

```json
{
  "eventSource": "s3.amazonaws.com",
  "eventName": "PutObject",
  "requestParameters": {
    "bucketName": "my-bucket",
    "key": "myfile.txt"
  }
}
```

ğŸ” Think of **CloudTrail as a passive API logger** â€” like a CCTV for AWS APIs.

---

#### 2ï¸âƒ£ CloudTrail Feeds EventBridge (Silently)

- EventBridge has a **built-in integration** with CloudTrail for **management events**.
- If the event matches, it's **streamed in real-time**.
- You **donâ€™t even need to create a trail**.

âœ… CloudTrail â†’ EventBridge is **always on** (for supported events).
âš¡ Itâ€™s **push-based**, near real-time, and costs nothing extra.

---

#### 3ï¸âƒ£ EventBridge Rule Matches the Event

You create a rule like:

```json
{
  "source": ["aws.s3"],
  "detail-type": ["AWS API Call via CloudTrail"],
  "detail": {
    "eventName": ["PutObject"],
    "requestParameters": {
      "bucketName": ["my-bucket"]
    }
  }
}
```

ğŸ§  EventBridge:

- Parses each event
- Matches it against rule patterns
- If match âœ… â†’ **forwards event to target**

---

#### 4ï¸âƒ£ EventBridge Pushes to CodePipeline

- If the rule target is CodePipeline, EventBridge **pushes** a `StartPipelineExecution` request.
- You can inject parameters like S3 key using **input transformers**.

---

## ğŸ§¬ Internal Architecture (Mermaid Style)

```mermaid
sequenceDiagram
    actor User
    participant S3
    participant CloudTrail
    participant EventBridge
    participant CodePipeline

    User->>S3: Upload object (PutObject)
    S3-->>CloudTrail: Log API call
    CloudTrail-->>EventBridge: Stream management event
    EventBridge-->>EventBridge: Rule Match
    EventBridge->>CodePipeline: StartPipelineExecution (with S3 key)
    CodePipeline-->>User: Run success
```

ğŸ§  **Behind the magic**: No polling, no daemons. **CloudTrail feeds EventBridge â†’ EventBridge routes â†’ target runs**.

---

## ğŸ§ª End-to-End Setup Table

| ğŸ”¢ Step | ğŸ› ï¸ Action                                                    |
| ------- | ------------------------------------------------------------ |
| 1ï¸âƒ£      | User uploads `file.txt` to S3 bucket                         |
| 2ï¸âƒ£      | CloudTrail records the `PutObject` API call                  |
| 3ï¸âƒ£      | EventBridge receives the CloudTrail event (real-time stream) |
| 4ï¸âƒ£      | EventBridge rule matches `eventName: PutObject`              |
| 5ï¸âƒ£      | CodePipeline is invoked as a target                          |

---

## ğŸ›¡ï¸ Security & Permissions

| Component         | Required Permission                                                    |
| ----------------- | ---------------------------------------------------------------------- |
| **EventBridge**   | Needs `codepipeline:StartPipelineExecution` permission                 |
| **Pipeline Role** | Should allow overrides if sending input artifacts / revision overrides |

### ğŸ” Example IAM Permission for EventBridge

```json
{
  "Effect": "Allow",
  "Action": "codepipeline:StartPipelineExecution",
  "Resource": "arn:aws:codepipeline:us-east-1:123456789012:MyPipeline"
}
```

---

## ğŸ’¡ Key Takeaways for Devs & Cert Exams

| Question                                                | Answer                                                                       |
| ------------------------------------------------------- | ---------------------------------------------------------------------------- |
| Does EventBridge pull or push to targets?               | âœ… **Push** â€“ you define rules and it delivers events to targets immediately |
| Does S3 directly emit events to EventBridge?            | âŒ No â€“ CloudTrail emits management events to EventBridge on S3â€™s behalf     |
| Does CloudTrail push to SNS or SQS directly?            | âŒ No â€“ only EventBridge or S3/CloudWatch for logging                        |
| Is a trail needed for EventBridge to get S3 API events? | âŒ No â€“ real-time CloudTrail EventStream to EventBridge works without trails |
| Is the flow near-real-time?                             | âœ… Yes â€“ latency is in the range of **a few seconds**                        |

---

## ğŸ¯ Final Thought

AWS EventBridge **isn't a black box** â€” itâ€™s a **smart router** that silently listens to AWS API changes (via CloudTrail), filters them, and routes them **instantly** to your AWS services like CodePipeline, Lambda, or SQS.
