# ğŸ”„ **Amazon EventBridge: Event Transformation**

> _Transform your event before sending it to the target â€“ no extra Lambda or code needed!_

---

## ğŸ¯ Why Use Transformation?

EventBridge lets you **manipulate event content** using:

- âœ… **Input Transformer**: Modify what is extracted from the event.
- âœ… **Input Path**: Extract a subset of fields.
- âœ… **Input Template**: Build a new payload from that subset.

ğŸ‰ Great for:

- Renaming keys
- Reformatting JSON
- Mapping to another service's expected format
- Avoiding extra Lambda invocations just to reshape events

---

## ğŸ§  Example Event

Hereâ€™s an incoming event:

```json
{
  "source": "my.app",
  "detail-type": "order_event",
  "detail": {
    "orderId": "X987",
    "customerId": "C456",
    "total": 150,
    "priority": "high"
  }
}
```

You want to send this to SNS in a simple format like:

```json
{
  "message": "High priority order received: X987 for customer C456"
}
```

---

## ğŸ› ï¸ Step-by-Step: Input Transformer in Action

### ğŸ”§ Step 1: Create a Rule in EventBridge

Go to:

> **EventBridge > Rules > Create Rule**

### ğŸ§¾ Select "Event Pattern"

```json
{
  "source": ["my.app"],
  "detail-type": ["order_event"]
}
```

---

### âœ‚ï¸ Step 2: Add Input Transformer

#### ğŸ” Input Path

```json
{
  "orderId": "$.detail.orderId",
  "customerId": "$.detail.customerId"
}
```

> This tells EventBridge to extract only these two fields.

#### ğŸ§° Input Template

```json
{
  "message": "High priority order received: <orderId> for customer <customerId>"
}
```

---

### ğŸ¯ Step 3: Select a Target

Target: SNS, Lambda, Step Functions, or anything supported.

ğŸ¯ With the transformed message as the **new payload** sent to the target!

---

## ğŸ§ª Hands-On with AWS CLI

```bash
aws events put-rule \
  --name "order-transform-rule" \
  --event-pattern '{
    "source": ["my.app"],
    "detail-type": ["order_event"]
  }'
```

### Attach Input Transformer to SNS Target

```bash
aws events put-targets \
  --rule "order-transform-rule" \
  --targets '[
    {
      "Id": "snsTarget",
      "Arn": "arn:aws:sns:us-east-1:123456789012:orders-topic",
      "InputTransformer": {
        "InputPathsMap": {
          "orderId": "$.detail.orderId",
          "customerId": "$.detail.customerId"
        },
        "InputTemplate": "{\"message\": \"High priority order received: <orderId> for customer <customerId>\"}"
      }
    }
  ]'
```

---

## ğŸ” Output Transformer (NEW â€“ 2023+)

You can now **transform the response** from the target service using an **Output Transformer** â€” useful when chaining services like Step Functions or Lambdas.

> Currently only available for certain destinations (like Step Functions, Pipes, etc.).

---

## ğŸ’¡ Tips & Use Cases

| Use Case                            | Transformation Role                 |
| ----------------------------------- | ----------------------------------- |
| Clean JSON format for targets       | Input Transformer                   |
| Remove unneeded fields              | Input Path                          |
| Avoid intermediary Lambda           | Input Template                      |
| Rename or re-key fields             | Input Template                      |
| Combine values into a sentence      | Input Template string interpolation |
| Reformat AWS service event payloads | Input Transformer to flatten/rekey  |

---

## ğŸ“š Real-World Scenarios

âœ… **S3 â†’ EventBridge â†’ Lambda**

S3 sends a big payload. You extract only `bucket.name` and `object.key` and create a readable message like:

```json
{
  "message": "File s3://my-bucket/uploads/image.png uploaded"
}
```

âœ… **Custom App â†’ EventBridge â†’ SNS**

You notify an admin about high-value orders only â€” format message from JSON to clean text.

âœ… **EventBridge Pipes** (Advanced)

Use transformations directly in **Pipes** to integrate services like DynamoDB â†’ Step Functions â†’ SNS, without code.

---

## ğŸ“Š Visual Example

```json
"InputPathsMap": {
  "orderId": "$.detail.orderId",
  "total": "$.detail.total"
}
```

```json
"InputTemplate": "{\"summary\": \"Order <orderId> received, total amount: <total> USD\"}"
```

---

## ğŸ“ Final Notes

- âœ… You **donâ€™t need to write Lambda code** to shape payloads.
- âœ… Works across **EventBridge rules, Pipes, and Step Functions**.
- âš ï¸ **Not all targets support Output Transformation** yet â€” check AWS docs.
