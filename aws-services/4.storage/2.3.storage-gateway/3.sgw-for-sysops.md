# ğŸ—ƒï¸ **AWS Storage Gateway â€“ SysOps Essentials**

> ğŸ§° For system administrators managing hybrid storage and optimizing S3-based access

---

## ğŸ”Œ What is AWS Storage Gateway?

**AWS Storage Gateway** connects your on-premises infrastructure to AWS cloud storage. It supports three modes:

- ğŸ“‚ **File Gateway** â†’ NFS/SMB access to Amazon S3
- ğŸ’¾ **Volume Gateway** â†’ Block storage via iSCSI
- ğŸï¸ **Tape Gateway** â†’ Virtual tape library for backup

---

## ğŸ§± File Gateway â€“ POSIX Friendly

ğŸ“¦ **POSIX Compliant**

- Supports Linux file systems (ownership, permissions, timestamps)
- Stores file metadata directly in **S3 object metadata**

âœ… **Use Case**: Lift-and-shift Linux-based file systems with permissions intact

---

## ğŸ” Rebooting Gateways (Maintenance/Recovery)

| Gateway Type            | Reboot Process                                                    |
| ----------------------- | ----------------------------------------------------------------- |
| **File Gateway**        | Just **restart the VM**                                           |
| **Volume/Tape Gateway** | 1ï¸âƒ£ Stop Storage Gateway Service â†’ 2ï¸âƒ£ Reboot VM â†’ 3ï¸âƒ£ Start Service |

ğŸ‘‰ Restart can be done via:

- ğŸ–¥ï¸ Local VM Console
- ğŸŒ AWS Console
- ğŸ§ª Storage Gateway API

---

## ğŸ§‘â€ğŸ’» Storage Gateway â€“ Activation Process

To activate your gateway, you need an **activation key**.

---

<div style="text-align: center;">
    <img src="images/sgw-activation.png" alt="sgw-activation" style="border-radius: 10px; width: 80%;">
</div>

---

### ğŸ”‘ Ways to Get Activation Key

1. **Gateway VM CLI**
   Select option `0` â†’ Get activation key from the VM shell

2. **Web Method (Port 80)**
   Run this from your browser or CLI:

```bash
curl http://<vm_ip_address>/?activationRegion=<your_aws_region>&no_redirect
```

âš ï¸ **Troubleshooting Tips**:

- âœ… Ensure **port 80 is open**
- ğŸ•’ Sync time via **NTP server**, or activation may fail

---

## ğŸ§  Cached Volume Gateway â€“ Smart Block Storage

ğŸ“¥ **Cached Volume Mode**:

- Most recent blocks stored locally
- Remainder fetched on-demand from S3

---

<div style="text-align: center;">
    <img src="images/sgw-cached-volume.png" alt="sgw-cached-volume" style="border-radius: 10px; width: 80%;">
</div>

---

### ğŸ“Š Key Metrics

| Metric             | Purpose                                              |
| ------------------ | ---------------------------------------------------- |
| `CacheHitPercent`  | % of reads served from local cache (higher = better) |
| `CachePercentUsed` | How full your cache disk is (lower is better)        |

### ğŸ› ï¸ Tips to Improve Performance

- Expand your cache disk
- Create a larger volume â†’ **clone** from existing cached volume
- Monitor via **CloudWatch**

---

## ğŸ§ª Real-World Scenario: File Gateway Activation

```mermaid
sequenceDiagram
    actor Admin
    participant VM as ğŸ–¥ï¸ Gateway VM
    participant AWS as â˜ï¸ AWS Console
    participant NTP as ğŸ•“ NTP Server

    Admin->>VM: Launch File Gateway (OVA/VM)
    Admin->>VM: Open local console
    VM-->>Admin: Shows eth0 IP address
    Admin->>VM: curl 'http://<IP>?activationRegion=us-east-1&no_redirect'
    VM->>AWS: Registers with Activation Key
    VM->>NTP: Sync time
    AWS-->>Admin: Gateway activated
```

---

## ğŸ“Œ Summary

| Feature                | File Gateway  | Volume Gateway           |
| ---------------------- | ------------- | ------------------------ |
| Storage Type           | Object (S3)   | Block (iSCSI)            |
| Reboot Method          | Restart VM    | Stop â†’ Reboot â†’ Start    |
| Activation Method      | CLI / Port 80 | Same                     |
| Performance Tip        | Expand Cache  | Monitor iSCSI throughput |
| POSIX Metadata Support | âœ… Yes        | âŒ No                    |

---

## âœ… Best Practices

- Always sync time using **NTP**
- Watch **CacheHitPercent** for volume gateways
- Keep port 80 open during **activation**
- Use **File Gateway** for NFS/SMB workloads needing metadata
- Consider **cached mode** for read-heavy workloads
