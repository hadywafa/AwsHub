# ğŸŒğŸ” **Server Name Indication (SNI): One IP, Many Secure Hosts**

> _How can a single IP serve **multiple HTTPS domains** with the right certificate for each?_
> Answer: **SNI** â€” a simple trick that modern browsers and AWS load balancers use every day.

---

<div style="text-align: center;">
    <img src="images/sni.png" alt="Server Name Indication (SNI)" style="border-radius: 10px;">
</div>

---

## ğŸ¤” **What Is SNI? (Simplified)**

**SNI (Server Name Indication)** is a feature of the **TLS (HTTPS)** protocol.
It lets the **client (like your browser)** tell the **server (like an ALB/NLB)** **which domain itâ€™s trying to reach â€” before** encryption starts.

### ğŸ§  Why?

Because the server needs to **pick the correct SSL/TLS certificate**.
With SNI, it can do that **on the fly**, even when **many domains share the same IP address**.

---

## ğŸ“¦ **Real-World Example**

You have **1 ALB** with IP `13.1.2.3`, and it handles:

- `www.mystore.com`
- `admin.mystore.com`
- `api.mystore.com`

All 3 domains are **served on the same port (443)** with **different certificates**.

### ğŸ”„ What happens when a user visits `https://admin.mystore.com`?

1. The browser says â€œHi! Iâ€™m trying to reach `admin.mystore.com`â€ inside the TLS handshake (`ClientHello`).
2. The ALB reads this and picks the **matching certificate** for `admin.mystore.com`.
3. The secure connection continues â€” encrypted and correct âœ…

> ğŸ“Œ So yes, SNI allows **multiple domains** (hosts) on **one IP** using **the correct cert per request**.

---

## ğŸ› ï¸ **How SNI Works (Quick Visual)**

<div align="center">

```mermaid
sequenceDiagram
    participant Client as ğŸŒ Browser (Client)
    participant ALB as ğŸ›¡ï¸ ALB / NLB
    Client->>ALB: ClientHello (SNI = api.mystore.com)
    ALB-->>Client: ServerHello + Certificate for api.mystore.com
    Note over Client,ALB: ğŸ” Encrypted HTTPS session begins
```

</div>

---

## âš™ï¸ **How It Works in AWS**

### âœ… **Application Load Balancer (ALB)**

- Attach **multiple certificates** to the same ALB listener (HTTPS 443).
- AWS uses the **SNI hostname** to choose the right cert per request.

### âœ… **Network Load Balancer (NLB)** (TLS listeners)

- Supports SNI too!
- You can attach **multiple certificates**, and AWS matches them using the **hostname from the client**.

> ğŸ¯ No custom code is needed â€” **AWS handles SNI automatically** for HTTPS/TLS listeners.

---

## ğŸ§ª **Is SNI Always Sent? (Yes, if modern)**

SNI is **automatically included** in most HTTPS tools:

| Tool / Client         | Sends SNI? | Example                           |
| --------------------- | ---------- | --------------------------------- |
| Chrome, Firefox, Edge | âœ… Yes     | Visiting `https://yourdomain.com` |
| curl                  | âœ… Yes     | `curl https://yourdomain.com`     |
| Python requests       | âœ… Yes     | `requests.get('https://...')`     |
| Java HTTP clients     | âœ… Yes     | Unless using outdated JVMs        |

---

## ğŸ§  **Common Questions**

### â“ Can SNI handle more than one domain per IP?

**Yes**! Thatâ€™s the whole point.
Use **1 IP** (e.g., 1 ALB) to serve **many HTTPS domains** with their **own certs**.

---

### â“ What if the client doesnâ€™t support SNI?

AWS allows you to configure a **default certificate** that is always returned if no SNI is provided (very rare with modern clients).

---

### â“ How many certificates can I attach to an ALB?

Up to **25 certificates per HTTPS listener** (can be raised via support request).

---

## ğŸ¯ **Summary**

| Feature                | SNI Benefit                       |
| ---------------------- | --------------------------------- |
| ğŸ§  Purpose             | Serve multiple domains on one IP  |
| ğŸ” Selects Certificate | Based on clientâ€™s hostname        |
| ğŸŒ Works For           | Browsers, SDKs, AWS ALB/NLB       |
| â˜ï¸ In AWS              | ALB & NLB handle it automatically |
| ğŸ’¡ Result              | Correct certificate, secure HTTPS |

---

## ğŸ Final Thought

SNI is the **reason HTTPS at scale works**.
Thanks to it, you donâ€™t need a separate IP for every domain.

> _â€œOne IP to rule them all. One handshake to serve them.â€_ ğŸ˜‰
