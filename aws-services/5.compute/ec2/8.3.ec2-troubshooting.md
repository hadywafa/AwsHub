# ğŸ› ï¸ **Amazon EC2 Launch & Connection Troubleshooting Guide**

> _Fix common launch errors, capacity issues, and SSH access problems with EC2._

---

## ğŸš¨ **1. InstanceLimitExceeded**

**ğŸ” Error:**

```ini
InstanceLimitExceeded: You have reached your vCPU limit in this region.
```

**ğŸ’¡ Reason:**
You're hitting the **vCPU quota** limit for On-Demand or Spot instances in a specific region.

**âœ… Resolution:**

- ğŸ“ Launch in a **different region**
- ğŸ“¤ **Request a limit increase** via AWS Service Quotas
- ğŸ”¢ View your current limits:
  Console â†’ EC2 â†’ **Limits** â†’ Filter by "vCPU"

> â„¹ï¸ **vCPU-based quotas** only apply to **running** On-Demand and Spot instances â€” not Stopped or Reserved ones.

---

## âš ï¸ **2. InsufficientInstanceCapacity**

**ğŸ” Error:**

```ini
InsufficientInstanceCapacity: AWS does not have sufficient capacity to fulfill the request in this AZ.
```

**ğŸ’¡ Reason:**
The selected AZ doesn't currently have capacity for that instance type.

**âœ… Resolution:**

- ğŸ” Retry after a few minutes
- ğŸ“¦ Request fewer instances at a time (e.g., 5 â†’ 1+1+1...)
- ğŸ” Try a **different AZ** within the same region
- ğŸ”€ Use a **different instance type** and resize later

---

## âŒ **3. Instance Terminates Immediately**

**ğŸ” Symptom:**
EC2 instance goes from **Pending â†’ Terminated** in seconds

**ğŸ” Root Causes:**

- âš ï¸ EBS volume quota exceeded
- ğŸ§Š EBS snapshot is **corrupted**
- ğŸ” Root volume is **encrypted**, and you lack KMS access
- ğŸ“¦ **Instance store-backed AMI** is missing part files (e.g., `image.part.xx`)

**âœ… Resolution:**

- Open **EC2 Console â†’ Instances â†’ Description tab**
- Check **â€œState transition reasonâ€** for the cause
- Validate IAM access to KMS, or verify snapshot/AMI status

---

## ğŸ”’ **4. SSH Connection Troubleshooting**

### âœ… **Checklist:**

| â“ **Issue**                 | ğŸ” **Cause**                                                  |
| ---------------------------- | ------------------------------------------------------------- |
| ğŸ” â€œUnprotected private keyâ€ | `.pem` file not `chmod 400`                                   |
| â›” â€œPermission deniedâ€       | Wrong **username** (e.g., `ec2-user`, `ubuntu`, `admin`)      |
| ğŸ”‡ â€œConnection timed outâ€    | - Incorrect SG or NACL <br> - No public IP <br> - Bad routing |
| âš ï¸ No traffic out of subnet  | Missing route to **Internet Gateway** (IGW)                   |
| ğŸ§  SSH freeze                | Instance CPU is under **stress** or pegged to 100%            |

```bash
chmod 400 my-key.pem
ssh -i my-key.pem ec2-user@<public-ip>
```

---

## ğŸŒ **5. EC2 Instance Connect (vs. SSH)**

<div style="text-align: center;">
    <img src="images/ec2-instance-connect-vs-ssh.png" alt="EC2 Instance Connect" style="border-radius: 10px; width: 90%;">
</div>

---

| Feature                    | SSH              | EC2 Instance Connect              |
| -------------------------- | ---------------- | --------------------------------- |
| Uses `.pem` file           | âœ… Yes           | âŒ No need                        |
| Needs port 22 open to user | âœ… Yes (your IP) | âŒ No (just allow AWS IP range)   |
| Web console access         | âŒ No            | âœ… Yes                            |
| Good for temporary access  | âŒ Not ideal     | âœ… Auto-expiring public key (60s) |

**EC2 Connect Requirements:**

- Security Group must allow:

  ```ini
  Source: 18.206.107.24/29
  Port: TCP 22
  ```

- Uses the EC2 Connect API to **push a temporary public key**

  > ğŸ“˜ Full list of IP ranges:
  > [https://ip-ranges.amazonaws.com/ip-ranges.json](https://ip-ranges.amazonaws.com/ip-ranges.json)

---

## ğŸ§  **Pro Tips**

- ğŸ§ª **Test connectivity** with `telnet <public-ip> 22` or `nc -vz`
- ğŸ›¡ï¸ **Restrict SSH** access using `/32` CIDR for trusted IPs only
- ğŸ’¬ Use **EC2 Session Manager** if no SSH or public IP is allowed
- ğŸ§­ Place new EC2s in **public subnets** if you expect external SSH
