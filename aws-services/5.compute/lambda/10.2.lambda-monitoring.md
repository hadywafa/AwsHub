# ğŸ“ˆ **Lambda Monitoring with CloudWatch â€“ From Metrics to Insights**

> _Know exactly what your Lambda is doing, when it breaks, and how to fix it â€“ all through CloudWatch._

---

## ğŸ“Š **Lambda CloudWatch Metrics (Automatic)**

These are **pushed by AWS** every time your Lambda runs:

| ğŸ“Œ Metric                | ğŸ“˜ Description                                                |
| ------------------------ | ------------------------------------------------------------- |
| **Invocations**          | Number of times the function is called (success or failure)   |
| **Duration**             | Time (ms) your function runs from trigger to finish           |
| **Errors**               | Number of failed invocations (exceptions, timeouts, etc.)     |
| **Throttles**            | Invocations that were blocked due to concurrency limits       |
| **DeadLetterErrors**     | Failed attempts to send an event to DLQ for async invocations |
| **IteratorAge**          | Age of the latest record in stream before Lambda processes it |
| **ConcurrentExecutions** | Number of Lambda workers running simultaneously               |

---

### ğŸ§  **Example CloudWatch Alarm Use Cases**

| ğŸ”” Alarm Name        | ğŸ“Œ Trigger Condition                                  |
| -------------------- | ----------------------------------------------------- |
| `NoInvocations`      | No Lambda calls in last hour (ğŸ• inactivity alert)    |
| `LambdaErrorsAlarm`  | If `Errors > 0` â†’ notify DevOps                       |
| `HighThrottlesAlarm` | If `Throttles > 0` â†’ increase concurrency or optimize |

---

<div align="center">

```mermaid
sequenceDiagram
    participant Lambda
    participant CW Alarm
    participant SNS

    Lambda->>CW Alarm: Emit metrics
    CW Alarm->>CW Alarm: Threshold check
    alt Triggered
        CW Alarm->>SNS: Send alert ğŸ””
    end
```

</div>

---

## ğŸ“„ **Lambda Logs â€“ CloudWatch Logs**

Every Lambda logs to a dedicated **log group**:

```ini
/aws/lambda/your-function-name
```

- Each **log stream** contains one executionâ€™s output
- Requires Lambda role permission:

```json
("logs:CreateLogGroup", "logs:CreateLogStream", "logs:PutLogEvents")
```

ğŸ“¸ Diagram:

<div style="text-align: center;">
    <img src="images/lambda-to-cw-logs.png" alt="Lambda to CloudWatch Logs" style="border-radius: 10px; width: 80%;">
</div>

---

## ğŸ” **CloudWatch Logs Insights â€“ Powerful Log Search**

Use structured queries to:

- Filter ğŸ” logs
- Count âŒ errors
- Investigate cold starts ğŸ¥¶
- Detect timeouts â³

ğŸ“‹ Example:

```sql
fields @timestamp, @message
| filter @message like /ERROR/
| sort @timestamp desc
```

ğŸ§  Common Queries:

<div style="text-align: center;">
    <img src="images/cw-logs-insights-common-queries.png" alt="CloudWatch Logs Insights Common Queries" style="border-radius: 10px; width: 80%;">
</div>

---

## ğŸ“Š **Lambda Insights â€“ Enhanced Monitoring**

> Advanced metrics via **CloudWatch Lambda Extension**.

âœ… Lambda Insights provides:

| ğŸ“ˆ Metric Type           | ğŸ” Examples                                   |
| ------------------------ | --------------------------------------------- |
| **System Metrics**       | CPU, memory, network, disk                    |
| **Function Diagnostics** | Cold starts, shutdown reason, memory max used |
| **Networking**           | Bytes sent/received                           |

ğŸ“¦ Output appears under `/aws/lambda-insights/...`
Includes structured JSON like:

```json
{
  "function_name": "cpu-intensive",
  "duration": 45191,
  "cold_start": true,
  "timeout": true,
  "shutdown_reason": "Timeout",
  "used_memory_max": 63,
  ...
}
```

## âœ… Summary Cheat Sheet

| Tool                   | Purpose                            | Data You Get                            |
| ---------------------- | ---------------------------------- | --------------------------------------- |
| **CloudWatch Metrics** | Function KPIs (duration, errors)   | Auto-generated for every Lambda         |
| **CloudWatch Alarms**  | Alerting on thresholds             | Triggers based on metrics (SNS/email)   |
| **CloudWatch Logs**    | Logs from `console.log()`          | Stored in log groups/streams            |
| **Logs Insights**      | Query/search logs                  | Find errors, cold starts, memory issues |
| **Lambda Insights**    | Enhanced diagnostics (system view) | CPU, memory, shutdown reason            |
