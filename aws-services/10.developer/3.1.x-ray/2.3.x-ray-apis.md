# ğŸ”Œ **AWS X-Ray APIs â€“ Read & Write Explained**

> ğŸ’¬ AWS X-Ray exposes a set of **APIs** that let the daemon (and you) upload trace data, fetch trace information, retrieve graphs, and manage sampling behavior â€” giving you **deep control and visibility** over your distributed traces.

---

## âœï¸ **Write APIs â€“ Used by the X-Ray Daemon**

These APIs are used internally by the **X-Ray daemon** or SDK to send trace and telemetry data to the X-Ray service.

---

<div style="text-align: center;">
    <img src="images/x-ray-apis-write.png" alt="X-Ray Write APIs" style="border-radius: 10px; width: 60%;">
</div>

---

### ğŸ”¹ `PutTraceSegments`

- ğŸš€ **Uploads trace segment documents**
- Includes:

  - Full trace info: segment ID, timestamps, subsegments, service info
  - Sent in batches every second by the daemon

### ğŸ”¹ `PutTelemetryRecords`

- ğŸ“Š Sends **telemetry metrics** about the daemonâ€™s health
- Includes:

  - `SegmentsReceivedCount`
  - `SegmentsRejectedCount`
  - `BackendConnectionErrors`

> âœ… Useful for **monitoring the health of the X-Ray agent** itself!

---

### ğŸ“„ **IAM Permissions for Write APIs**

To allow your app or daemon to send data, the IAM role must include:

```json
{
  "Effect": "Allow",
  "Action": ["xray:PutTraceSegments", "xray:PutTelemetryRecords", "xray:GetSamplingRules", "xray:GetSamplingTargets"],
  "Resource": "*"
}
```

> ğŸ” Use the AWS-managed policy:
> `arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess`

---

## ğŸ¯ **Sampling Control APIs**

These APIs help the daemon **fetch sampling configuration**, which determines how many requests to trace.

### ğŸ”¹ `GetSamplingRules`

- ğŸ“œ Returns the **current list of sampling rules** from X-Ray
- Used by the daemon to decide what to trace

### ğŸ”¹ `GetSamplingTargets`

- ğŸ¯ Provides dynamic **quotas and rate limits** for each rule (reservoirs, quotas)

### ğŸ”¹ `GetSamplingStatisticSummaries`

- ğŸ“ˆ Returns **metrics about sampling** activity (e.g., number of requests traced per rule)

---

## ğŸ‘ï¸ **Read APIs â€“ View Traces & Service Maps**

These APIs are used to **retrieve trace data**, graphs, and summaries â€” perfect for custom monitoring dashboards, analytics, or troubleshooting tools.

---

<div style="text-align: center;">
    <img src="images/x-ray-apis-read.png" alt="X-Ray Read APIs" style="border-radius: 10px; width: 60%;">
</div>

---

### ğŸ”¹ `GetServiceGraph`

- ğŸŒ Returns the **visual service graph**
- Shows how services interact with each other over a time range
- Useful for architecture discovery and dependency tracing

### ğŸ”¹ `GetTraceSummaries`

- ğŸ” Lists **trace IDs** and high-level data (annotations, duration, start time)
- Used to **filter** and paginate traces over a specific time range
- âœ… Used before `BatchGetTraces` to find trace candidates

### ğŸ”¹ `BatchGetTraces`

- ğŸ“¦ Retrieves **full details** of specific traces (by Trace IDs)
- Includes:

  - All segments and subsegments
  - Exceptions, throttling, annotations
  - Timing and latency info

### ğŸ”¹ `GetTraceGraph`

- ğŸ§¬ Like `GetServiceGraph` but for **specific trace IDs**
- Useful when you already know which traces you want to inspect

---

## ğŸ§  **Visual Summary of API Usage**

```mermaid
flowchart LR
  subgraph Write Path
    App[Your App + SDK] --> Daemon[X-Ray Daemon]
    Daemon --> A[PutTraceSegments]
    Daemon --> B[PutTelemetryRecords]
    Daemon --> C[GetSamplingRules]
    Daemon --> D[GetSamplingTargets]
  end

  subgraph Read Path
    User[You / Dashboard] --> E[GetTraceSummaries]
    E --> F[BatchGetTraces]
    User --> G[GetServiceGraph]
    User --> H[GetTraceGraph]
  end
```

---

## âœ… **Summary Table**

| API Name                        | Type  | Purpose                               |
| ------------------------------- | ----- | ------------------------------------- |
| `PutTraceSegments`              | Write | Uploads raw trace data                |
| `PutTelemetryRecords`           | Write | Sends daemon metrics                  |
| `GetSamplingRules`              | Write | Fetches current sampling rules        |
| `GetSamplingTargets`            | Write | Gets quotas for sampling              |
| `GetSamplingStatisticSummaries` | Write | View sampling activity metrics        |
| `GetServiceGraph`               | Read  | Visual graph of service dependencies  |
| `GetTraceSummaries`             | Read  | Get a list of trace metadata          |
| `BatchGetTraces`                | Read  | Fetch full details of specific traces |
| `GetTraceGraph`                 | Read  | Visual graph for specific traces      |

---

## ğŸ“Œ Final Tips

- âš™ï¸ These APIs are used by X-Ray under the hood â€” but you can use them directly in **your own monitoring tools** or **custom dashboards**
- ğŸ›¡ï¸ Always configure **IAM permissions** carefully, especially if running the daemon in **cross-account setups**
- ğŸ” For custom search, use `GetTraceSummaries` with filters (annotations, duration, etc.)
